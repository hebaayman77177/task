<html>

<head>
    <!-- matter.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.11.0/matter.min.js"
        type="application/javascript"></script>

    <!-- bootstrap library -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

    <!-- introjs libraries -->
    <link href="https://unpkg.com/intro.js/minified/introjs.min.css" rel="stylesheet">
    <link href="https://unpkg.com/intro.js/themes/introjs-modern.css" rel="stylesheet">
    <script src="https://unpkg.com/intro.js/minified/intro.min.js"></script>

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <!-- fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Sacramento&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <style>
        .frminp {
            border: none;
            margin: 2em;
            /* margin-top:1em; */
            margin-bottom: 1em;
            padding: 0.5em;
            color: black;
            border-radius: 0;
        }

        body {
            background-color: #f5f5f7;
            color: #0f0f13;
            height: 100%;
            direction: rtl;
            transition: all 1s linear;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 25px;


        }

        a {
            text-decoration: none;
            color: #0f0f13;
        }

        form {
            margin-top: 0;
            display: flex;
            justify-content: center;

        }

        #renderport {
            margin: auto;
            border-radius: 5px;
            background-color: black;
            padding: 0px;
            width: 1400px;
            padding: 10px;

        }

        .cusbutton {
            padding: 11px;
        }

        .introjs-prevbutton {
            float: right;
        }

        .introjs-nextbutton {
            float: left;
        }

        .introjs-tooltip {
            font-size: 20px;
        }
    </style>

</head>

<body>
    <div class="container-fluid text-center">
        <h1 id="header" style="font-family: 'Sacramento', cursive; font-size:50px"> حركة المقذوفات</h1>
        <form class="row row-cols-lg-auto g-3 align-items-center form">
            <div class="col-12">
                <label class="visually-hidden" fid="angl">الزاويه</label>
                <div class="input-group">
                    <div class="input-group-text"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                            fill="currentColor" class="bi bi-arrow-clockwise" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z" />
                            <path
                                d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z" />
                        </svg></div>
                    <input type="number" class="input-lg form-control" id="angl" placeholder="الزاويه">
                </div>
            </div>

            <div class="col-12">
                <label class="visually-hidden" fid="angl">السرعه</label>
                <div class="input-group">
                    <div class="input-group-text"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                            fill="currentColor" class="bi bi-speedometer2" viewBox="0 0 16 16">
                            <path
                                d="M8 4a.5.5 0 0 1 .5.5V6a.5.5 0 0 1-1 0V4.5A.5.5 0 0 1 8 4zM3.732 5.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707zM2 10a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 10zm9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5zm.754-4.246a.389.389 0 0 0-.527-.02L7.547 9.31a.91.91 0 1 0 1.302 1.258l3.434-4.297a.389.389 0 0 0-.029-.518z" />
                            <path fill-rule="evenodd"
                                d="M0 10a8 8 0 1 1 15.547 2.661c-.442 1.253-1.845 1.602-2.932 1.25C11.309 13.488 9.475 13 8 13c-1.474 0-3.31.488-4.615.911-1.087.352-2.49.003-2.932-1.25A7.988 7.988 0 0 1 0 10zm8-7a7 7 0 0 0-6.603 9.329c.203.575.923.876 1.68.63C4.397 12.533 6.358 12 8 12s3.604.532 4.923.96c.757.245 1.477-.056 1.68-.631A7 7 0 0 0 8 3z" />
                        </svg></div>
                    <input type="number" class="input-lg form-control" id="vel" placeholder="السرعه">
                </div>
            </div>

            <div class="col-12">
                <button id='positionReset' type="button" class="input-lg btn btn-primary cusbutton">رجع الكوره مكانها
                    الاول</button>
            </div>

            <div class="col-12">
                <button id='start' type="button" class="input-lg btn btn-primary cusbutton">ابتدي</button>
            </div>
            <div class="col-12">
                <button id='reset' type="button" class="input-lg btn btn-primary cusbutton">عيد</button>
            </div>
        </form>
        <div id="renderport"></div>

    </div>
    <script>


        document.addEventListener("DOMContentLoaded", function () {

            const domElements = {
                'renderPort': 'renderport',
                'footer': 'ftr',
                'angle': 'angl',
                'velocity': 'vel',
                'startButton': 'start',
                'resetButton': 'reset',
                'header': 'header',
                'positionReset': 'positionReset'
            }

            let renderPort = document.getElementById(domElements['renderPort']),
                footer = document.getElementById(domElements['footer']),
                angleInput = document.getElementById(domElements['angle']),
                velocityInput = document.getElementById(domElements['velocity']),
                startButton = document.getElementById(domElements['startButton']),
                resetButton = document.getElementById(domElements['resetButton']),
                header = document.getElementById(domElements['header']),
                positionResetButton = document.getElementById(domElements['positionReset']),

                ball,
                ballStartPosition = { x: 90, y: 390 },
                renderWidt = 1370,
                renderHeight = 700;


            const { Engine, Events, Render, Runner, Body,
                Composite, Composites, Constraint, MouseConstraint,
                Mouse, World, Bodies, Vector } = Matter

            /***** start intro part *****/
            // introduce how to use the simulation
            function intro() {

                let firstTime = localStorage.getItem('projictile7771777_first_time');
                if (firstTime !== null) return

                introJs().setOptions({
                    prevLabel: "ارجع",
                    nextLabel: "كمل",
                    doneLabel: "تمام",
                    steps: [{
                        intro: "اهلا بيك في تجربه حركه المقذوفات 	&#127881;	&#127881;	&#127881;"
                    }, {
                        element: renderPort,
                        intro: "حرك الكوره في المكان اللي انت حابب تبتدي بيه "
                    }, {
                        element: positionResetButton,
                        intro: " تقدر ترجع الكوره مكانها الاصلي"
                    }, {
                        element: angleInput,
                        intro: "دخل الزاويه"
                    }
                        , {
                        element: velocityInput,
                        intro: "دخل السرعه"
                    }, {
                        element: startButton,
                        intro: "ابتدي"
                    }, {
                        element: resetButton,
                        intro: "دوس اعاده عشان تكمل تاني"
                    }
                    ]
                }).start();

                localStorage.setItem('projictile7771777_first_time', true)
            }
            intro()
            /***** end intro part *****/

            /***** start state part *****/
            const state = {
                toStart: true,
                init: function () {
                    resetButton.style.display = "none";
                },
                toggleStartRest: function () {

                    if (this.toStart) {
                        startButton.style.display = "none";
                        resetButton.style.display = "inline";
                    } else {
                        resetButton.style.display = "none";
                        startButton.style.display = "inline";
                    }
                    this.toStart = !this.toStart
                }
            }
            state.init();
            /***** end state part *****/


            /**** start initializing matter.js the env ****/
            let engine = Engine.create();
            let render = Render.create({
                element: renderPort,
                engine: engine,
                options: {
                    width: renderWidt,
                    height: renderHeight,
                    wireframes: false,
                    background: '#161515'
                }
            });
            const mouse = Mouse.create(render.canvas);
            let mouseConstraint = MouseConstraint.create(engine, {
                mouse,
                constraint: {
                    stiffness: 1,
                    render: {
                        visible: false,
                    },
                },
            });
            const ground = Bodies.rectangle(400, renderHeight - 5, 5000, 60, {
                isStatic: true
            });
            ball = Bodies.circle(90, 390, 30, {
                render: {
                    fillStyle: '#dd4444',
                    strokeStyle: '#2b2b2c',
                    lineWidth: 3,
                }
            });
            engine.world.gravity.y = 1;
            World.add(engine.world, [ground, ball, mouseConstraint]);
            Engine.run(engine);
            Render.run(render);
            /**** start initializing matter.js the env ****/


            function run() {

                if (velocityInput.value.trim() === "" || angleInput.value.trim() === "") return

                velocityInput.disabled = true;
                angleInput.disabled = true;
                positionResetButton.disabled = true;

                //calculating horizontal and vertical velocity
                let angle = angleInput.value;
                angle = angle * (Math.PI) / 180;
                let v = velocityInput.value;
                vx = v * (Math.cos(angle));
                vy = -v * (Math.sin(angle));

                Matter.Body.setVelocity(ball, { x: vx, y: vy });
                state.toggleStartRest()


            }

            function reset() {

                velocityInput.disabled = false;
                angleInput.disabled = false;
                positionResetButton.disabled = false;

                Matter.Body.setVelocity(ball, { x: 0, y: 0 });
                Matter.Body.setPosition(ball, ballStartPosition);

                state.toggleStartRest()

                angleInput.value = ""
                velocityInput.value = ""

            }

            function positionReset() {
                Matter.Body.setPosition(ball, ballStartPosition);
            }

            // add event listeners
            startButton.addEventListener("click", run);
            resetButton.addEventListener("click", reset);
            positionResetButton.addEventListener("click", positionReset);

        })
    </script>

</body>

</html>